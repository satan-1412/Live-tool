<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OSB PLAYER | LIVE TERMINAL</title>
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Oswald:wght@500&display=swap" rel="stylesheet">
    
    <style>
        /* ================== üé® ËßÜËßâÁ≥ªÁªü ================== */
        :root {
            /* ÈªòËÆ§Ê®°Âºè (Safe Mode) */
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --text-main: #e6edf3;
            --text-sub: #8b949e;
            --accent-color: #3fb950;
            --highlight: rgba(63, 185, 80, 0.15);
            --border-color: #30363d;
            --font-display: 'Oswald', sans-serif;
            --font-body: 'Inter', sans-serif;
        }

        /* ÈöêËóèÊ®°Âºè (Root Mode) */
        body.root-access {
            --bg-color: #0a000a;
            --card-bg: #1a051a;
            --text-main: #ffe6ff;
            --text-sub: #d68bd6;
            --accent-color: #ff00ff;
            --highlight: rgba(255, 0, 255, 0.2);
            --border-color: #4d004d;
        }

        body {
            margin: 0; background-color: var(--bg-color); color: var(--text-main);
            font-family: var(--font-body); height: 100vh; display: flex; flex-direction: column;
            overflow: hidden; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
        }

        header {
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border-color); background: rgba(13, 17, 23, 0.95);
            backdrop-filter: blur(10px); z-index: 50; transition: border-color 0.5s;
        }

        .logo {
            font-family: var(--font-display); font-size: 24px; color: var(--accent-color);
            letter-spacing: 2px; cursor: pointer; user-select: none;
            text-shadow: 0 0 10px rgba(0,0,0,0.5); transition: 0.3s;
        }
        
        .search-box { position: relative; width: 40%; max-width: 300px; }
        .search-input {
            width: 100%; padding: 8px 15px 8px 35px; background: var(--card-bg);
            border: 1px solid var(--border-color); border-radius: 20px;
            color: var(--text-main); outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--accent-color); box-shadow: 0 0 8px var(--highlight); }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-sub); font-size: 12px; }

        /* Â∏ÉÂ±ÄÂÆπÂô® */
        #main-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        /* ËøõÂ∫¶Êù°/Âä†ËΩΩÊù° */
        #network-bar {
            height: 2px; width: 0%; background: var(--accent-color);
            position: absolute; top: 0; left: 0; transition: width 0.3s, opacity 0.3s; z-index: 60;
        }

        #category-bar {
            padding: 10px 20px; display: flex; gap: 15px; overflow-x: auto;
            border-bottom: 1px solid var(--border-color); white-space: nowrap;
            scrollbar-width: none; transition: border-color 0.5s;
        }
        #category-bar::-webkit-scrollbar { display: none; }
        
        .cat-btn {
            background: transparent; border: none; color: var(--text-sub);
            font-family: var(--font-display); font-size: 14px; cursor: pointer;
            padding: 5px 0; position: relative; transition: 0.3s; text-transform: uppercase;
        }
        .cat-btn.active { color: var(--accent-color); font-weight: bold; }
        .cat-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background: var(--accent-color); box-shadow: 0 0 5px var(--accent-color);
        }

        #grid-view {
            flex: 1; padding: 20px; overflow-y: auto;
            display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px; align-content: start;
        }

        .channel-card {
            background: var(--card-bg); border: 1px solid var(--border-color);
            border-radius: 8px; overflow: hidden; cursor: pointer;
            transition: all 0.3s; position: relative; aspect-ratio: 16/11;
            display: flex; flex-direction: column;
        }
        .channel-card:hover { transform: translateY(-3px); border-color: var(--accent-color); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .card-img-wrap {
            flex: 1; background: #000; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: center;
        }
        .card-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; transition: 0.3s; }
        .channel-card:hover .card-img { opacity: 1; transform: scale(1.05); }
        .img-placeholder { color: #333; font-family: monospace; font-weight: bold; font-size: 18px; }

        .card-info { padding: 8px 10px; background: var(--card-bg); border-top: 1px solid var(--border-color); }
        .card-title { font-size: 12px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }

        /* Êí≠ÊîæÂô® */
        #player-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column;
        }
        #player-modal.active { transform: translateY(0); }
        
        #video-stage { flex: 1; position: relative; background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        video { width: 100%; height: 100%; max-height: 100vh; }
        #danmaku-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20; }

        .ui-layer { position: absolute; left: 0; width: 100%; z-index: 30; transition: opacity 0.3s; }
        .ui-top { top: 0; height: 60px; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .ui-bottom { bottom: 0; padding: 15px 20px 30px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); display: flex; gap: 10px; align-items: center; opacity: 0; }
        #video-stage:hover .ui-bottom { opacity: 1; }

        .back-btn { color: #fff; cursor: pointer; font-size: 16px; font-weight: 600; text-shadow: 0 1px 2px #000; }
        .live-tag { border: 1px solid #ff0000; color: #ff0000; font-size: 10px; padding: 2px 6px; border-radius: 4px; display: flex; align-items: center; gap: 4px; background: rgba(0,0,0,0.3); font-family: var(--font-display); }
        .live-dot { width: 6px; height: 6px; background: #ff0000; border-radius: 50%; animation: blink 1s infinite; }

        .dm-input { flex: 1; background: rgba(255,255,255,0.15); border: none; border-radius: 20px; padding: 8px 15px; color: #fff; outline: none; backdrop-filter: blur(5px); }
        .icon-btn { width: 36px; height: 36px; color: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 50%; transition: 0.2s; }
        .icon-btn:hover { background: rgba(255,255,255,0.2); }

        @keyframes blink { 50% { opacity: 0; } }
        @keyframes pulse-red { 0% { text-shadow: 0 0 0 rgba(255,0,0,0); } 100% { text-shadow: 0 0 10px rgba(255,0,0,0.8); } }
        
        .triggering { animation: pulse-red 1s infinite alternate; color: #ff3333 !important; }

        #loader { position: absolute; color: var(--accent-color); font-family: monospace; display: none; }
    </style>
</head>
<body>

<div id="network-bar"></div>

<header>
    <div class="logo" id="osb-logo">OSB<span style="font-size:12px; opacity:0.6;"> TERMINAL</span></div>
    <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" id="search" placeholder="SEARCH FREQUENCY...">
    </div>
</header>

<div id="main-container">
    <div id="category-bar"></div>
    <div id="grid-view">
        <div style="margin-top:50px; width:100%; text-align:center; color:#555; font-family:monospace;">INITIALIZING...</div>
    </div>
</div>

<div id="player-modal">
    <div id="video-stage">
        <div id="loader">ESTABLISHING LINK...</div>
        <video id="video" playsinline webkit-playsinline></video>
        <canvas id="danmaku-canvas"></canvas>
        
        <div class="ui-layer ui-top">
            <div class="back-btn" onclick="closePlayer()"><i class="fas fa-arrow-left"></i> EXIT</div>
            <div class="live-tag"><div class="live-dot"></div> LIVE</div>
        </div>

        <div class="ui-layer ui-bottom">
            <input type="text" class="dm-input" id="dm-text" placeholder="Broadcast message...">
            <div class="icon-btn" onclick="sendDanmaku()"><i class="fas fa-paper-plane"></i></div>
            <div class="icon-btn" onclick="toggleDanmaku()"><i class="fas fa-eye"></i></div>
            <div class="icon-btn" onclick="toggleFullScreen()"><i class="fas fa-expand"></i></div>
        </div>
    </div>
</div>

<script>
    /* ================================================================
       SYSTEM CORE CONFIGURATION
       ================================================================
       Warning: Tampering with the core signal processor may cause
       system instability. 
    */

    const CORE = {
        // [ÂÖ¨ÂºÄÊ∫ê] Ê≠£Â∏∏Ê®°ÂºèÈªòËÆ§Âä†ËΩΩÔºå‰ªª‰Ωï‰∫∫ÈÉΩÁúãÂæóÂà∞ÁöÑ
        publicSignal: 'https://raw.githubusercontent.com/satan-1412/live/refs/heads/main/no%20sex/TV_1(no%20sex).m3u8',
        
        // [Âä†ÂØÜÊÆµ] ËøôÈáåÂ≠òÊîæÁöÑÊòØÊ∑∑Ê∑ÜÂêéÁöÑÊàê‰∫∫Ê∫êÂú∞ÂùÄÁâáÊÆµ
        // Âç≥‰ΩøÊúâ‰∫∫ÁúãÊ∫êÁ†ÅÔºå‰πüÂè™ËÉΩÁúãÂà∞‰∏ÄÂ†Ü‰π±Á†ÅÔºå‰∏çÁü•ÈÅìËøôÊòØ‰ªÄ‰πà
        _s: [
            "ODN1bS5WT", "y9uaWFt", "L2V2aWw", "vMjE0MS", "1uYXRh", "cy9tb2Mu", "dG5ldG5v", "Y3Jlc3U", "YnVodGln", "Lm3Ry", "Ly9zOk", "NwdHRo"
        ],
        
        triggerDuration: 10000 // 10ÁßíÈïøÊåâ
    };

    // Áä∂ÊÄÅÁÆ°ÁêÜ
    let state = {
        mode: 'SAFE', // 'SAFE' or 'ROOT'
        channels: [],
        category: 'ALL',
        hls: null,
        timer: null
    };

    // ================== üîí Ê∑∑Ê∑ÜËß£ÂØÜÊ®°Âùó ==================
    // ËøôÊòØ‰∏Ä‰∏™‰º™Ë£ÖÊàê‚ÄúÁΩëÁªúÂª∂ËøüËÆ°ÁÆó‚ÄùÁöÑÂáΩÊï∞ÔºåÂÆûÈôÖ‰∏äÊòØÊãºÂáëÁúüÂÆûURL
    function _calcLatency() {
        // ÈÄªËæëÔºöÂ∞ÜÊï∞ÁªÑÂèçËΩ¨ -> ÊãºÊé• -> Base64Ëß£Á†Å -> ÂÜçÊ¨°ÂèçËΩ¨Â≠óÁ¨¶‰∏≤
        const raw = CORE._s.slice().reverse().join('');
        try {
            const decoded = atob(raw); // Base64 decode
            return decoded.split('').reverse().join(''); // String reverse
        } catch(e) { return ''; }
    }
    
    // ÂàùÂßãÂåñ
    window.onload = () => {
        loadSignal(CORE.publicSignal); // ÈªòËÆ§Âä†ËΩΩÂÖ¨ÂºÄÊ∫ê
        initTrigger();
        initDanmaku();
    };

    // ================== üì° ‰ø°Âè∑Âä†ËΩΩÊ®°Âùó ==================
    function loadSignal(url) {
        // Ê®°ÊãüÂä†ËΩΩÊù°
        const bar = document.getElementById('network-bar');
        bar.style.width = '70%';
        bar.style.opacity = '1';
        
        document.getElementById('grid-view').innerHTML = '<div style="margin-top:50px;width:100%;text-align:center;color:#666;font-family:monospace;">> SYNCING DATABASE...</div>';

        fetch(url)
            .then(r => r.text())
            .then(data => {
                bar.style.width = '100%';
                setTimeout(() => { bar.style.opacity = '0'; bar.style.width = '0%'; }, 300);
                parseData(data);
            })
            .catch(() => {
                bar.style.background = 'red';
                document.getElementById('grid-view').innerHTML = '<div style="margin-top:50px;width:100%;text-align:center;color:red;">SIGNAL LOST</div>';
            });
    }

    function parseData(m3u8) {
        state.channels = [];
        const lines = m3u8.split('\n');
        for(let i=0; i<lines.length; i++) {
            const line = lines[i].trim();
            if(line.startsWith('#EXTINF')) {
                const title = line.split(',')[1] || 'Unknown';
                const logo = (line.match(/tvg-logo="([^"]+)"/) || [])[1] || '';
                const group = (line.match(/group-title="([^"]+)"/) || [])[1] || 'Unclassified';
                const url = lines[i+1] ? lines[i+1].trim() : '';
                if(url && url.startsWith('http')) {
                    state.channels.push({ title, logo, group, url });
                }
            }
        }
        renderUI();
    }

    // ================== üé® UI Ê∏≤ÊüìÊ®°Âùó ==================
    function renderUI() {
        // 1. ÊèêÂèñÂàÜÁ±ª
        const groups = new Set(['ALL']);
        state.channels.forEach(c => groups.add(c.group));
        
        // 2. Ê∏≤ÊüìÂØºËà™Ê†è
        const nav = document.getElementById('category-bar');
        nav.innerHTML = '';
        groups.forEach(g => {
            const btn = document.createElement('button');
            btn.className = `cat-btn ${g === state.category ? 'active' : ''}`;
            btn.innerText = g;
            btn.onclick = () => {
                state.category = g;
                renderUI(); // ÈáçÊñ∞Ê∏≤Êüì
            };
            nav.appendChild(btn);
        });

        // 3. Ê∏≤ÊüìÂÆ´Ê†º
        const grid = document.getElementById('grid-view');
        grid.innerHTML = '';
        const keyword = document.getElementById('search').value.toLowerCase();
        
        const list = state.channels.filter(c => {
            if(state.category !== 'ALL' && c.group !== state.category) return false;
            if(keyword && !c.title.toLowerCase().includes(keyword)) return false;
            return true;
        });

        if(list.length === 0) {
            grid.innerHTML = '<div style="width:100%;text-align:center;padding:50px;color:#444;">NO DATA FOUND</div>';
            return;
        }

        list.forEach(c => {
            const el = document.createElement('div');
            el.className = 'channel-card';
            el.onclick = () => playStream(c.url);
            
            let img = c.logo ? `<img src="${c.logo}" class="card-img" onerror="this.style.display='none'">` : '';
            
            el.innerHTML = `
                <div class="card-img-wrap">
                    <span class="img-placeholder">OSB</span>
                    ${img}
                </div>
                <div class="card-info"><span class="card-title">${c.title}</span></div>
            `;
            grid.appendChild(el);
        });
    }

    document.getElementById('search').addEventListener('input', renderUI);

    // ================== ü•ö Á≥ªÁªüÂΩ©Ëõã (Ê†∏ÂøÉÈÄªËæë) ==================
    function initTrigger() {
        const logo = document.getElementById('osb-logo');
        
        const startAction = (e) => {
            // e.preventDefault(); // Â¶ÇÂΩ±ÂìçÁÇπÂáªÂèØËß£ÂºÄ
            state.timer = setTimeout(() => {
                toggleSystemMode();
            }, CORE.triggerDuration);
            logo.classList.add('triggering');
        };

        const endAction = () => {
            clearTimeout(state.timer);
            logo.classList.remove('triggering');
        };

        // ÂÖºÂÆπ PC Âíå ÁßªÂä®Á´Ø
        logo.addEventListener('mousedown', startAction);
        logo.addEventListener('touchstart', startAction);
        logo.addEventListener('mouseup', endAction);
        logo.addEventListener('mouseleave', endAction);
        logo.addEventListener('touchend', endAction);
    }

    function toggleSystemMode() {
        const body = document.body;
        // ÈúáÂä®ÂèçÈ¶à
        if(navigator.vibrate) navigator.vibrate([200]);

        if(state.mode === 'SAFE') {
            // ÂàáÂÖ• ROOT Ê®°Âºè (Êàê‰∫∫)
            state.mode = 'ROOT';
            body.classList.add('root-access');
            // Ëß£ÂØÜÂπ∂Âä†ËΩΩÈöêËóèÊ∫ê
            const secretUrl = _calcLatency(); 
            loadSignal(secretUrl);
            alert("SYSTEM OVERRIDE: ROOT ACCESS GRANTED");
        } else {
            // ÂàáÂõû SAFE Ê®°Âºè (Ê≠£Â∏∏)
            state.mode = 'SAFE';
            body.classList.remove('root-access');
            loadSignal(CORE.publicSignal);
            alert("SYSTEM RESTORED: SAFE MODE");
        }
        state.category = 'ALL'; // ÈáçÁΩÆÂàÜÁ±ª
    }

    // ================== üé¨ Êí≠ÊîæÊ†∏ÂøÉ ==================
    const video = document.getElementById('video');
    const modal = document.getElementById('player-modal');
    const loader = document.getElementById('loader');

    function playStream(url) {
        modal.classList.add('active');
        loader.style.display = 'block';
        
        if(Hls.isSupported()) {
            if(state.hls) state.hls.destroy();
            state.hls = new Hls();
            state.hls.loadSource(url);
            state.hls.attachMedia(video);
            state.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                loader.style.display = 'none';
                video.play();
            });
        } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.onloadedmetadata = () => {
                loader.style.display = 'none';
                video.play();
            };
        }
    }

    function closePlayer() {
        modal.classList.remove('active');
        video.pause();
        video.src = "";
        if(state.hls) state.hls.destroy();
        clearDanmaku();
    }
    
    function toggleFullScreen() {
        const stage = document.getElementById('video-stage');
        if(!document.fullscreenElement) stage.requestFullscreen().catch(()=>{});
        else document.exitFullscreen();
    }

    // ================== üöÄ ÊûÅÁÆÄÂºπÂπïÂºïÊìé ==================
    const canvas = document.getElementById('danmaku-canvas');
    const ctx = canvas.getContext('2d');
    let danmakus = [];
    let showDM = true;

    function initDanmaku() {
        resize();
        window.addEventListener('resize', resize);
        loop();
    }
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.font = "bold 22px sans-serif";
    }
    function sendDanmaku() {
        const input = document.getElementById('dm-text');
        const txt = input.value.trim();
        if(!txt) return;
        danmakus.push({
            text: txt,
            x: canvas.width,
            y: 50 + Math.random() * (canvas.height/3),
            color: '#fff',
            speed: 3 + Math.random() * 2
        });
        input.value = '';
    }
    function toggleDanmaku() {
        showDM = !showDM;
        canvas.style.opacity = showDM ? 1 : 0;
    }
    function clearDanmaku() { danmakus = []; }
    
    function loop() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(showDM) {
            for(let i=0; i<danmakus.length; i++) {
                let d = danmakus[i];
                d.x -= d.speed;
                ctx.fillStyle = d.color;
                ctx.shadowColor = 'black';
                ctx.shadowBlur = 4;
                ctx.fillText(d.text, d.x, d.y);
                if(d.x < -ctx.measureText(d.text).width) {
                    danmakus.splice(i,1); i--;
                }
            }
        }
        requestAnimationFrame(loop);
    }
    document.getElementById('dm-text').addEventListener('keypress', e => {
        if(e.key==='Enter') sendDanmaku();
    });

</script>
</body>
</html>
