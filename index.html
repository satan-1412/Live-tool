<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OSB PLAYER | PRO</title>
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;600&family=Noto+Sans+SC:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ================== ğŸ¨ è§†è§‰å†…æ ¸ V3.0 ================== */
        :root {
            /* [æ­£å¸¸æ¨¡å¼] å•†åŠ¡/æç®€/é«˜ç«¯é»‘ */
            --bg-color: #0a0a0a;
            --bg-image: none; /* æ­£å¸¸æ¨¡å¼æ— èƒŒæ™¯å›¾ï¼Œçº¯è‰² */
            --card-bg: rgba(255, 255, 255, 0.05);
            --text-main: #f0f0f0;
            --text-sub: #888;
            --accent: #00ff88; /* æå…‰ç»¿ */
            --border: rgba(255, 255, 255, 0.1);
            --blur: 10px;
            --font-main: 'Noto Sans SC', sans-serif;
            --font-display: 'Exo 2', sans-serif;
        }

        /* [æˆäººæ¨¡å¼] æš§æ˜§/ç²‰çº¢/æ’å›¾ */
        body.root-mode {
            /* ğŸ”¥ åœ¨è¿™é‡Œå¡«å…¥ä½ æƒ³è¦çš„æˆäººæ¨¡å¼èƒŒæ™¯å›¾é“¾æ¥ (JPG/PNG/GIF) ğŸ”¥ */
            --bg-image: url('https://cdni.pornpics.com/460/3/17/42759567/42759567_006_fca4.jpg'); 
            --bg-color: #1a0510;
            --card-bg: rgba(40, 0, 20, 0.6); /* åŠé€æ˜çº¢ç´« */
            --text-main: #xffddee;
            --text-sub: #ff99cc;
            --accent: #ff0077; /* éœ“è™¹ç²‰ */
            --border: rgba(255, 0, 119, 0.3);
            --blur: 20px; /* æ›´å¼ºçš„æ¯›ç»ç’ƒ */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            background-image: var(--bg-image);
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--text-main); font-family: var(--font-main);
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden; transition: all 0.6s ease;
        }
        
        /* é®ç½©å±‚ï¼šè®©èƒŒæ™¯å›¾æš—ä¸€ç‚¹ï¼Œæ–‡å­—æ›´æ¸…æ™° */
        body::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.9));
            z-index: -1; pointer-events: none;
        }

        /* ================== ğŸ“± å“åº”å¼å¤´éƒ¨ ================== */
        header {
            padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(var(--blur));
            border-bottom: 1px solid var(--border); z-index: 50;
        }

        .logo {
            font-family: var(--font-display); font-size: 22px; font-weight: 700;
            color: var(--accent); letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(0,0,0,0.5); cursor: pointer; user-select: none;
        }
        
        .search-container {
            position: relative; width: 40%; max-width: 300px;
        }
        .search-input {
            width: 100%; background: rgba(255,255,255,0.1); border: 1px solid var(--border);
            border-radius: 50px; padding: 8px 15px 8px 35px; color: #fff; outline: none;
            font-size: 14px; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--accent); }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-sub); font-size: 12px; }

        /* ================== ğŸ§Š é€‚é…å®«æ ¼ç³»ç»Ÿ ================== */
        #main-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* å¯¼èˆªæ¡ */
        #nav-scroll {
            padding: 10px 15px; display: flex; gap: 15px; overflow-x: auto;
            border-bottom: 1px solid var(--border); scrollbar-width: none;
        }
        #nav-scroll::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            background: transparent; border: none; color: var(--text-sub);
            font-size: 15px; font-weight: 500; white-space: nowrap; cursor: pointer;
            padding: 5px 10px; border-radius: 20px; transition: 0.3s;
        }
        .nav-btn.active { background: var(--accent); color: #000; box-shadow: 0 0 10px var(--accent); }

        /* é¢‘é“åˆ—è¡¨ - æ ¸å¿ƒå“åº”å¼ä¿®æ”¹ */
        #channel-grid {
            flex: 1; padding: 20px; overflow-y: auto;
            display: grid; 
            /* PCç«¯: æœ€å°å®½åº¦160pxï¼Œè‡ªåŠ¨å¡«æ»¡ */
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px; align-content: start;
        }
        
        /* æ‰‹æœºç«¯ä¸“ç”¨å¸ƒå±€ */
        @media (max-width: 768px) {
            #channel-grid {
                padding: 15px; gap: 15px;
                /* æ‰‹æœºç«¯: å¼ºåˆ¶åŒåˆ—ï¼Œä¸å†æŒ¤åœ¨ä¸€èµ· */
                grid-template-columns: repeat(2, 1fr);
            }
            .logo { font-size: 18px; }
            .search-container { width: 50%; }
        }

        .card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            border: 1px solid var(--border); cursor: pointer; aspect-ratio: 16/10;
            display: flex; flex-direction: column; position: relative;
            transition: transform 0.2s, box-shadow 0.2s; backdrop-filter: blur(5px);
        }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        
        .card-img-box { flex: 1; background: #000; position: relative; overflow: hidden; }
        .card-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; transition: 0.5s; }
        .card:hover .card-img { opacity: 1; transform: scale(1.1); }
        
        /* é»˜è®¤å›¾ */
        .card-placeholder {
            position: absolute; top:0; left:0; width:100%; height:100%;
            display: flex; justify-content: center; align-items: center;
            font-family: var(--font-display); font-size: 20px; color: var(--text-sub); opacity: 0.3;
        }

        .card-title {
            padding: 10px; font-size: 13px; color: var(--text-main);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;
            background: rgba(0,0,0,0.3);
        }

        /* ================== ğŸ¬ ç»ˆææ’­æ”¾å™¨ (è§£å†³è¾“å…¥é®æŒ¡) ================== */
        #player-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; display: none;
            flex-direction: column;
        }
        #player-modal.active { display: flex; }

        /* è§†é¢‘å®¹å™¨ï¼šè‡ªé€‚åº”é«˜åº¦ */
        #video-container {
            position: relative; width: 100%; flex: 1; background: #000;
            display: flex; align-items: center; justify-content: center;
        }
        
        /* æ‰‹æœºç«¯è¾“å…¥æ³•å¼¹å‡ºæ—¶çš„ç‰¹æ®Šå¤„ç†ï¼šè®©è§†é¢‘å˜å°ï¼ŒæŒ¤åˆ°ä¸Šé¢å» */
        body.keyboard-active #video-container { flex: 0 0 40vh; /* è§†é¢‘åªå 40%é«˜åº¦ */ }

        video { width: 100%; height: 100%; max-height: 100%; object-fit: contain; }
        #danmaku-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 20; }

        /* é¡¶éƒ¨ UI */
        .player-top {
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            z-index: 30; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
        }
        .close-btn { color: #fff; font-size: 24px; cursor: pointer; filter: drop-shadow(0 0 3px #000); }
        
        /* LIVE é—ªçƒå›¾æ ‡ */
        .live-status {
            display: flex; align-items: center; gap: 6px;
            background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.6);
            padding: 4px 10px; border-radius: 4px; color: #ff3333; font-weight: bold; font-size: 12px;
        }
        .live-dot { width: 8px; height: 8px; background: red; border-radius: 50%; animation: blink 1s infinite; box-shadow: 0 0 5px red; }

        /* åº•éƒ¨æ§åˆ¶æ  */
        .player-bottom {
            width: 100%; padding: 10px 15px; 
            background: #111; /* çº¯è‰²èƒŒæ™¯é˜²æ­¢é€è§† */
            border-top: 1px solid #333;
            display: flex; gap: 10px; align-items: center; z-index: 40;
            /* é€‚é… iPhone åº•éƒ¨æ¨ªæ¡ */
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }

        .dm-input {
            flex: 1; background: #222; border: 1px solid #444; color: #fff;
            padding: 10px 15px; border-radius: 20px; outline: none; font-size: 14px;
        }
        .dm-input:focus { border-color: var(--accent); background: #000; }
        
        .action-btn {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #ddd; font-size: 18px; cursor: pointer; transition: 0.2s;
        }
        .action-btn:active { background: rgba(255,255,255,0.2); transform: scale(0.9); }
        .send-btn { color: var(--accent); }

        @keyframes blink { 0%,100% {opacity:1} 50% {opacity:0.3} }
        /* Logo å‘¼å¸ */
        @keyframes pulse-color { 0% {color: var(--accent);} 50% {color: #fff; text-shadow:0 0 15px var(--accent);} 100% {color: var(--accent);} }
        .triggering { animation: pulse-color 0.5s infinite; }

    </style>
</head>
<body>

<header>
    <div class="logo" id="osb-logo">OSB <span style="font-size:12px;opacity:0.6">PRO</span></div>
    <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" id="search-box" placeholder="æœç´¢é¢‘é“...">
    </div>
</header>

<div id="main-container">
    <div id="nav-scroll"></div> <div id="channel-grid">
        <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #666;">
            <i class="fas fa-satellite-dish fa-spin"></i> æ­£åœ¨è¿æ¥å«æ˜Ÿä¿¡å·...
        </div>
    </div>
</div>

<div id="player-modal">
    <div id="video-container">
        <video id="video-player" playsinline webkit-playsinline></video>
        <canvas id="danmaku-layer"></canvas>
        
        <div class="player-top">
            <div class="close-btn" onclick="closePlayer()"><i class="fas fa-chevron-down"></i></div>
            <div class="live-status"><div class="live-dot"></div> LIVE</div>
        </div>
    </div>

    <div class="player-bottom">
        <div class="action-btn" onclick="toggleDanmaku()"><i class="fas fa-comment-slash" id="dm-icon"></i></div>
        <input type="text" class="dm-input" id="dm-input" placeholder="å‘ä¸ªå¼¹å¹•..." autocomplete="off">
        <div class="action-btn send-btn" onclick="sendDanmaku()"><i class="fas fa-paper-plane"></i></div>
        <div class="action-btn" onclick="toggleFullScreen()"><i class="fas fa-expand"></i></div>
    </div>
</div>

<script>
    // ================= é…ç½®ä¸­å¿ƒ =================
    const CONFIG = {
        // [å…¬å¼€æº] æ­£å¸¸æ¨¡å¼ (è¯·ç¡®ä¿é“¾æ¥æ­£ç¡®)
        safeUrl: 'https://raw.githubusercontent.com/satan-1412/live/refs/heads/main/no%20sex/TV_1(no%20sex).m3u8',
        
        // [åŠ å¯†å‚æ•°] æˆäººæº (æ··æ·†å¤„ç†)
        // è§£å¯†åä¸º: https://raw.githubusercontent.com/satan-1412/live/main/TV.m3u8
        _secret: "ODN1bS5WVC9uaWFtL2V2aWwvMjE0MS1uYXRhcy9tb2MudG5ldG5vY3Jlc3VidWh0aWcud2FyLy86c3B0dGg=",
        
        triggerTime: 10000 // 10ç§’è§¦å‘
    };

    // çŠ¶æ€æœº
    let appState = {
        mode: 'SAFE', // SAFE or ROOT
        data: [],
        currentCat: 'ALL',
        hls: null
    };

    // ================= æ ¸å¿ƒé€»è¾‘ =================
    
    window.onload = () => {
        loadM3U8(CONFIG.safeUrl);
        initTrigger();
        initDanmaku();
        initKeyboardFix(); // å¯åŠ¨æ‰‹æœºé”®ç›˜ä¼˜åŒ–
    };

    // 1. æ•°æ®åŠ è½½ä¸è§£å¯†
    function getSecretUrl() {
        // åè½¬ Base64 é€»è¾‘
        try {
            const str = atob(CONFIG._secret);
            return str.split('').reverse().join('');
        } catch(e) { return ''; }
    }

    function loadM3U8(url) {
        // æ˜¾ç¤ºåŠ è½½ä¸­
        document.getElementById('channel-grid').innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; margin-top:50px; color:var(--text-sub);">
                <i class="fas fa-sync fa-spin"></i> UPDATING DATABASE...
            </div>`;

        fetch(url)
            .then(r => r.text())
            .then(text => {
                parseData(text);
            })
            .catch(err => {
                document.getElementById('channel-grid').innerHTML = 
                `<div style="color:red;text-align:center;padding:20px">SIGNAL LOST<br>æ— æ³•è¿æ¥æœåŠ¡å™¨</div>`;
            });
    }

    function parseData(m3u8) {
        appState.data = [];
        const lines = m3u8.split('\n');
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (line.startsWith('#EXTINF')) {
                const info = line.split(',')[1] || 'Unknown';
                const logo = (line.match(/tvg-logo="([^"]+)"/) || [])[1] || '';
                // æå– group-title
                const group = (line.match(/group-title="([^"]+)"/) || [])[1] || 'å…¶å®ƒ';
                const url = lines[i+1] ? lines[i+1].trim() : '';
                
                if (url && url.startsWith('http')) {
                    appState.data.push({ title: info, logo, group, url });
                }
            }
        }
        
        // æ•°æ®åŠ è½½å®Œç«‹åˆ»æ¸²æŸ“
        renderNav();
        renderGrid();
    }

    // 2. æ¸²æŸ“ UI
    function renderNav() {
        const groups = new Set(['ALL']);
        appState.data.forEach(d => groups.add(d.group));
        
        const nav = document.getElementById('nav-scroll');
        nav.innerHTML = '';
        
        groups.forEach(g => {
            const btn = document.createElement('button');
            btn.className = `nav-btn ${g === appState.currentCat ? 'active' : ''}`;
            btn.innerText = g;
            btn.onclick = () => {
                appState.currentCat = g;
                renderNav(); // æ›´æ–°é«˜äº®
                renderGrid(); // æ›´æ–°åˆ—è¡¨
            };
            nav.appendChild(btn);
        });
    }

    function renderGrid() {
        const grid = document.getElementById('channel-grid');
        grid.innerHTML = '';
        
        const searchVal = document.getElementById('search-box').value.toLowerCase();
        
        const filtered = appState.data.filter(item => {
            if (appState.currentCat !== 'ALL' && item.group !== appState.currentCat) return false;
            if (searchVal && !item.title.toLowerCase().includes(searchVal)) return false;
            return true;
        });

        if (filtered.length === 0) {
            grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#555;padding:50px">æ— æœç´¢ç»“æœ</div>`;
            return;
        }

        filtered.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.onclick = () => openPlayer(item.url);
            
            // å›¾ç‰‡å¤„ç†
            let imgTag = `<div class="card-placeholder">OSB</div>`;
            if (item.logo) {
                imgTag = `<img src="${item.logo}" class="card-img" onerror="this.style.opacity=0">`;
            }

            card.innerHTML = `
                <div class="card-img-box">
                    ${imgTag}
                    <div class="card-placeholder">TV</div> 
                </div>
                <div class="card-title">${item.title}</div>
            `;
            grid.appendChild(card);
        });
    }
    
    // æœç´¢ç›‘å¬
    document.getElementById('search-box').addEventListener('input', renderGrid);

    // 3. æ’­æ”¾å™¨é€»è¾‘
    const playerModal = document.getElementById('player-modal');
    const video = document.getElementById('video-player');

    function openPlayer(url) {
        playerModal.classList.add('active');
        
        if (Hls.isSupported()) {
            if (appState.hls) appState.hls.destroy();
            appState.hls = new Hls();
            appState.hls.loadSource(url);
            appState.hls.attachMedia(video);
            appState.hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
        
        initDanmakuLoop(); // å¯åŠ¨å¼¹å¹•
    }

    function closePlayer() {
        playerModal.classList.remove('active');
        video.
